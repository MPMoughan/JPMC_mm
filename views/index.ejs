<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Document</title>

  <script src="http://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>


</head>
<body>
<div>
<h2>JPMC ATM / Branch Locator</h2>


<p>Click the button to find the nearest ATM or Branch locations.</p>
<p><small>WARNING: If order to find your location, you must allow your browser to share your location.</small></p>

<button id="button1" onclick="getLocation()">ATM Locator</button></div>

</div>
<br>
<div class="branchLoc"> Here are your results! </div>

<script>

var x = document.getElementById("demo");

function getLocation() {
    if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(showPosition);
    } else {
        x.innerHTML = "We truly apologize, Geolocation is not currently not supported by this version of your browser. For closet ATM or Branch locations, please call: ";
    }
}


function showPosition(position) {
    // latitude
    var latitude = position.coords.latitude;

    //
    var longitude = position.coords.longitude;

    // url variable passed into AJAX call
    var url = "https://m.chase.com/PSRWeb/location/list.action?lat=" + latitude + "&lng=" + longitude;

    console.log("Did the function reach this point? -- true")

    // Original getJSON request
    // JSONP ??
    // $.getJSON(url, { jsonp: false, jsonpCallback: "callbackName" }, function(data) { document.write(data.locations[0].label); });

    // jQuery - AJAX call to the specified URL to retrieve the information
    $(document).ready(function(){
      $("#button1").click(function(){
        $.ajax({
          url : url,
          type : "GET",
          // dataType: 'jsonp',
          // jsonp: 'onJSONPLoad',
          // jsonpCallback: 'showPosition',
          // cache: true,

          // success function for AJAX call
          // result = the returned object
          success : function(result) {
              // console.log(result.locations);
              // for loop - loop over the locations array within the result object

                for (var i = 0, len = result.locations.length; i < len; ++i) {
                  var label = result.locations[i].label;
                  var address = result.locations[i].address;
                  var city = result.locations[i].city;
                  var zip = result.locations[i].zip;
                  var locType = result.locations[i].locType;
                  var atm = result.locations[i].atms;
                    console.log(label);
                    console.log(address);
                    console.log(city);
                    console.log(zip);
                    console.log(locType);
                    console.log(atm);
            $(".branchLoc").append(
              "<li>" + label + "</li>"
            );
          };
        },
        error : function() {
          alert("operation did not work")
          }
        });
      });
    });
  };



</script>

</body>
</html>
